# VPC, 서브넷

# **VPC(Virtual Private Cloud)**

- AWS 사용자 계정 전용 가상 네트워크
- AWS 클라우드에서 다른 가상 네트워크와 논리적으로 분리
- 한 AWS 리안 안에서만 존재할 수 있고, 한 리전에 만든 VPC는 다른 리전에서는 보이지 않음 ⇒ VPC Peering
- 생성시 RFC 1918에 지정된 프라이빗 주소 체계 사용을 권장
    - 10.0.0.0/8 ⇒ 10.0.0.0 - 10.255.255.255
    - 172.16.0.0/12 ⇒ 172.16.0.0 - 172.31.255.255
    - 192.168.0.0/16 ⇒ 192.168.0.0 - 192.168.255.255

## **VPC 구성 옵션**

https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/create-vpc.html

## **기본 VPC (default VPC)**

https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/default-vpc.html

Amazon VPC를 사용하기 시작하는 경우 각 AWS 리전에 기본 VPC가 있습니다. 기본 VPC는 각 가용 영역의 퍼블릭 서브넷, 인터넷 게이트웨이 및 DNS 확인 활성화 설정과 함께 제공됩니다. 따라서 기본 VPC로 Amazon EC2 인스턴스를 즉시 시작할 수 있습니다. 기본 VPC에서 Elastic Load Balancing, Amazon RDS, Amazon EMR 같은 서비스를 사용할 수도 있습니다.

### **기본 VPC 구성 요소**

- IPv4 CIDR 블록의 크기가 /16인 VPC를 만듭니다 (**172.31.0.0/16**). 이는 최대 65,536개의 프라이빗 IPv4 주소를 제공합니다.
- 각 가용 영역에 크기 **/20의 기본 서브넷을 생성**합니다. 이렇게 하면 서브넷당 최대 4,096개의 주소가 제공되며, 그중 몇 개는 내부용으로 예약되어 있습니다.
- **인터넷 게이트웨이**를 만들어 기본 VPC에 연결합니다.
- 기본 라우팅 테이블에 **모든 트래픽(0.0.0.0/0)이 인터넷 게이트웨이로 전달되는 경로를 추가**합니다.
- **기본 보안 그룹**을 만들어 기본 VPC와 연결합니다.
- **네트워크 ACL(액세스 제어 목록)**을 생성하여 기본 VPC와 연결합니다.
- AWS 계정에서 설정된 **기본 DHCP 옵션**을 기본 VPC와 연결합니다.

## **서브넷(subnet)**

- VPC 내 논리 구분
- 인스턴스는 서브넷 안에 위치 ⇒ EC2 인스턴스를 배치하는 장소
    - 한번 서브넷에 인스턴스를 생성하면 다른 서브넷으로 옮길 수 없음
    - 인스턴스를 종료하고 다른 서브넷에 새 인스턴스를 만들 수는 있음
- 인스턴스를 서로 격리하고, 인스턴스 간의 트래픽 흐름을 제어하고, 인스턴스를 기능별로 묶을 수 있음
- 서브넷은 하나의 가용 영역(AZ, Availablility Zone) 내에서만 존재할 수 있음
- 서브넷 CIDR 블록
    - VPC의 일부, VPC 내에서는 유니크해야 함
    - 모든 서브넷에서 처음 4개의 IP와 마지막 1개는 예약되어 있으므로 인스턴스에 할당할 수 없음

예) 서브넷 CIDR이 172.16.100.0/24인 경우

172.16.100.0		네트워크 주소

172.16.100.1		AWS에서 VPC 라우터용으로 예약

172.16.100.2		DNS 서버 주소

172.16.100.3		AWS에서 나중에 사용하려고 예약

127.15.100.255 	네트워크 브로드캐스트 주소

- 퍼블릿 서브넷 : 서브넷이 인터넷 게이트웨어로 향하는 라우팅이 있는 라우팅 테이블과 연결된 경우
- 프라이빗 서브넷 : 서브넷이 인터넷 게이트웨어로 향하는 라우팅이 없는 라우팅 테이블과 연결된 경우

## **ENI(Elastic Network Interface, 탄력적 네트워크 인터페이스)**

- 물리 서버의 네트워크 인터페이스와 같은 기능을 수행
- VPC에서 가상 네트워크 카드를 나타내는 논리적 네트워크 구성 요소

## **인터넷 게이트웨이(igw)**

- 퍼블릭 IP 주소를 갖는 인스턴스가 인터넷에 연결할 수 있도록 기능을 제공
- 처음 VPC를 만들면 인터넷 게이트웨이가 연결되어 있지 않으므로, 직접 인터넷 게이트웨이를 만들고 VPC와 연결해야 함
- 하나의 VPC는 하나의 IGW만 연결할 수 있음