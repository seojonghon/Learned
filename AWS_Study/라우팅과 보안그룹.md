# 라우팅과 보안그룹

## **라우팅(routing)**

- VPC의 네트워크 트래픽을 전달할 위치를 결정하는데 사용되는 규칙
- 트래픽을 전달할 IP 주소 범위(대상 주소)와 트래픽을 전송할 게이트웨이, 네트워크 인터페이스 또는 연결(대상)을 지정
- VPC는 소프트웨어 함수로 IP 라우팅을 구현 → 사용자는 라우팅 테이블만 관리
- 라우팅 테이블 ⇒ 라우팅 집합으로, 서브넷과 연결할 수 있음
- 기본 라우팅 테이블 ⇒ VPC와 함께 자동으로 제공되는 라우팅 테이블
    - 기본 VPC인 경우, local 및 igw로의 라우팅을 포함
    - 기본 VPC가 아닌 경우, local 라우팅만 포함
- ----------	---------------------

대상 주소	대상

- ----------	---------------------

172.31.0.0/16	local

0.0.0.0/0	igw-0b7313723843100f9

~~~~~~~~~	~~~~~~~~~~~~~~~~~~~~~

|		인터넷 게이트웨이

+-- 인터넷 상의 모든 호스트 IP를 기반

⇒ 172.31.10.10으로 패킷을 보낼려고 하면, local로 라우팅을 처리

⇒ 198.51.100.50으로 패킷을 보낼려고 하면, ...

라우팅할 위치와 가장 근접하게 일치하는 항목을 기반으로 라우팅을 처리 → IGW로 라우팅됨

⇒ **라우팅 테이블의 항목들간의 순서는 중요하지 않음**

---------------------------------	---------------------

대상 주소				대상

---------------------------------	---------------------

10.0.0.0/16				Local

2001:db8:1234:1a00::/56		Local

172.31.0.0/16				pcx-11223344556677889

0.0.0.0/0				igw-12345678901234567

::/0					eigw-aabbccddee1122334

- --------------------------------	---------------------
- VPC(10.0.0.0/16) 내에서 라우팅되는 IPv4 트래픽은 Local 경로로 처리
- VPC(2001:db8:1234:1a00::/56) 내에서 라우팅되는 IPv6 트래픽은 Local 경로로 처리
- 172.31.0.0/16의 경로는 피어링 연결로 트래픽을 전송
- 모든 IPv4 트래픽(0.0.0.0/0)의 경로는 인터넷 게이트웨이로 트래픽을 전송 ⇒ VPC 내 그리고 피어링 연결을 통한 트래픽을 제외한 모든 IPv4 트래픽은 인터넷 게이트웨이로 라우팅
- 모든 IPv6 트래픽(::/0)의 경로는 외부 전용 인터넷 게이트웨이로 트래픽을 전송 ⇒ VPC 내 트래픽을 제외한 모든 IPv6 트래픽은 외부 전용 인터넷 게이트웨이로 라우팅

## **보안 그룹(security group)**

- 방화벽과 같은 기능을 제공
- **인스턴스의 ENI**에서 송수신하는 트래픽을 제어
- 모든 ENI는 최소 한 개 이상의 보안 그룹과 연결되어야 하고, 보안 그룹은 여러 ENI와 연결될 수 있음
- 생성할 때 보안 그룹 이름, 설명, 포함될 VPC를 지정하고, 생성 후에 인바운드, 아웃바운드 규칙을 지정 ⇒ 트래픽을 허용
- **상태 저장 방화벽 역할** ⇒ 보안 그룹이 트래픽을 한 방향으로 전달하도록 허용할 때 반대 방향의 응답 트래픽을 지능적으로 허용

## **NACL(Network Access Control List)**

https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/vpc-network-acls.html#default-network-acl

- 보안 그룹과 유사
    - 원본 또는 대상 주소 CIDR, 프로토콜, 포트를 기반으로 트래픽을 인바운드, 아웃바운드 규칙으로 제어 ⇒ 방화벽과 같은 역할

https://lh7-us.googleusercontent.com/n1E6wIns9AhWtRSNNwtCGgRRUoqIS3l7q0dzXoKCtAhf11xqE5sBAVcpeIh31HHvdKNwcwTkEMKQW79yP0W1bJWRYUkxag5epoocf0n2bNYt66ku1rAXHOGMGQ2uByhj-Htcf4ipTFcrQeyehI-XUYU

- VPC에는 삭제할 수 없는 기본 NACL이 있음
- **서브넷에 연결**되어 해당 서브넷과 송수신되는 트래픽을 제어
- **상태 비저장**
    - NACL을 통과한 연결 상태를 추적하지 않음
    - 모든 인바운드와 아웃바운드 트래픽의 허용 규칙을 별도로 작성해야 함
- **규칙을 적용할 때 규칙 번호의 오름차순으로 처리**

## **보안 그룹과 NACL 비교**